name: accessibility-code-audit
description: WCAG 2.2 analysis with AI-powered collaborative fixes
version: "1.0"

settings:
  optimization:
    enabled: true
    smartRouting: true

steps:
  # Step 1: Scan for accessibility issues
  - name: accessibility-scan
    tool: gemini_analyze_code
    input:
      code: "${input}"
      focus: "general"
    saveToFile: true
    output:
      variable: a11y_scan

  # Step 2: Research WCAG standards
  - name: wcag-standards
    tool: perplexity_ask
    input:
      query: "WCAG 2.2 accessibility standards and compliance requirements 2025"
      searchRecency: "month"
      searchDomain: "general"
    saveToFile: true
    output:
      variable: wcag_standards

  # Step 3: Collaborative fix debate (Gemini + Qwen)
  - name: fix-generation-debate
    tool: pingpong
    input:
      problem: "Given accessibility issues: ${a11y_scan} and standards: ${wcag_standards}, debate the best fixes"
      models: ["gemini", "qwen"]
      rounds: 3
      style: "collaborative"
    saveToFile: true
    output:
      variable: proposed_fixes

  # Step 4: Verify fixes are correct
  - name: verify-fixes
    tool: verifier
    input:
      query: "Verify these accessibility fixes are WCAG 2.2 compliant: ${proposed_fixes}"
      variant: "fact_check"
      includeSources: true
    saveToFile: true
    output:
      variable: verified_fixes

  # Step 5: Generate final code
  - name: generate-fixed-code
    tool: qwen_coder
    input:
      task: "optimize"
      code: "${input}"
      requirements: "Implement these verified accessibility fixes: ${verified_fixes}"
    saveToFile: true
    output:
      variable: fixed_code

  # Step 6: Executive Summary (using Gemini 2.5 Flash)
  - name: executive-summary
    tool: gemini_analyze_text
    input:
      text: |
        ${a11y_scan}
        ${wcag_standards}
        ${proposed_fixes}
        ${verified_fixes}
        ${fixed_code}
      task: |
        Synthesize accessibility audit into executive summary:

        1. Issues found (count and severity)
        2. WCAG 2.2 compliance gaps identified
        3. Fixes applied (summary)
        4. Compliance level achieved
        5. Remaining recommendations

        Keep under 1500 words for Claude Code.
    maxTokens: 5000
    output:
      variable: audit_summary

output:
  format: "detailed"
  truncateSteps: false
