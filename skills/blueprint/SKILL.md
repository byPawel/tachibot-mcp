---
name: blueprint
description: Multi-model implementation planning — creates bite-sized TDD plans using planner_maker's council pipeline
user-invocable: true
---

# Blueprint — Multi-Model Implementation Planning

Creates implementation plans using a multi-model council (Grok search, Qwen/Kimi analysis, GPT critique with pre-mortem, Gemini final judgment). Output is in bite-sized TDD format: exact files, test-first steps, commit points.

## Usage
```
/blueprint [task description]
/blueprint [task] --context [additional context]
/blueprint [task] --code [paste relevant code]
/blueprint [task] --ux                          — include UX/accessibility review
/blueprint [task] --responsive                  — include responsive design review
/blueprint [task] --debate                      — include pro/con debate steps
/blueprint [task] --issue [path/to/issue.md]    — load spec from file
```

## When to Use

- Before implementing non-trivial features
- When you need a structured plan with exact files and steps
- When you want multi-model perspectives before coding
- When requirements are complex or ambiguous

## Pipeline (what happens under the hood)

```
Step 1: Grok Search      — ground truth, latest docs
Step 2: Qwen Analysis    — technical deep-dive
Step 3: Kimi Analysis    — step-by-step edge cases
Step 4: Kimi Decompose   — subtasks + dependencies
Step 5: GPT Critique     — pre-mortem (assume it failed, find why)
Step 6: Qwen Draft       — synthesize into draft plan
Step 7: Gemini Final     — bite-sized TDD output format
```

Optional steps: debate (pro/con), UX review, responsive review.

## Instructions

When user invokes `/blueprint [task]`:

### Step 1: Parse Input

Extract from user message:
- **task** — the main task description
- **context** — any `--context` value, or surrounding conversation context
- **codeContext** — any `--code` value, or if user mentions specific files, read them and paste contents
- **flags** — `--ux`, `--responsive`, `--debate`, `--issue`

### Step 2: Start the Pipeline

```
mcp__tachibot-mcp__planner_maker({
  task: "[task]",
  context: "[context if any]",
  codeContext: "[code if any]",
  mode: "start",
  ux: [true if --ux],
  responsive: [true if --responsive],
  debate: [true if --debate],
  issueFile: "[path if --issue]"
})
```

This returns the FIRST tool to call and its parameters.

### Step 3: Execute the Coordinator Loop

The planner_maker uses a **coordinator pattern** — it returns ONE tool to execute at a time:

```
Loop:
  1. planner_maker returns { nextTool: { tool, params }, step, phase }
  2. Execute the returned tool with given params
  3. Call planner_maker again with mode: "continue", step: next, prior: { [stepId]: result }
  4. Repeat until isComplete: true
```

**Important**: Pass results back in the `prior` object using the step ID as key. The planner accumulates context server-side.

Show progress to user between steps:
```
Blueprint: [phase] (step N/M)...
```

### Step 4: Present the Final Plan

The last step (`judge_final`) outputs the plan in bite-sized TDD format:

```markdown
### Task N: [Component Name]
**Files:** Create: path/to/file | Modify: path/to/file:lines | Test: path/to/test
**Step 1:** Write the failing test (show test code)
**Step 2:** Run test to verify it fails (exact command + expected output)
**Step 3:** Write minimal implementation (show code)
**Step 4:** Run test to verify it passes (exact command)
**Step 5:** Commit (exact git command with message)
```

Present the full plan to the user. Then offer:

```
Blueprint complete. Options:

1. **Execute now** — I'll implement the plan task by task in this session
2. **Save to file** — Save as docs/plans/YYYY-MM-DD-[feature].md for later
3. **Refine** — Adjust specific tasks or add more detail
```

### If User Chooses "Execute now"

Work through each task in the plan sequentially:
1. Follow the exact steps (test-first, commit after each task)
2. Show progress after each task
3. Pause for feedback every 3 tasks

### If User Chooses "Save to file"

Save the plan with this header:
```markdown
# [Feature Name] Implementation Plan

> **For Claude:** Use superpowers:executing-plans to implement this plan task-by-task.

**Goal:** [One sentence]
**Architecture:** [2-3 sentences]
**Generated by:** planner_maker (multi-model council)
**Models used:** Grok, Qwen, Kimi, GPT, Gemini

---
[plan content]
```

## Examples

- `/blueprint add OAuth authentication with refresh tokens`
- `/blueprint refactor payment module to microservice --debate`
- `/blueprint add real-time collaboration --ux --responsive`
- `/blueprint implement rate limiter --code [paste current code]`
- `/blueprint redesign user dashboard --issue docs/specs/dashboard-v2.md`
